{% extends "layout.html" %}
{% load static %}

{% block title %}
Home
{% endblock %}

{% block google_chart %}

<!--Load the AJAX API-->
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

{% endblock %}

{% block content %}

{% if properties %}

<!-- property selector -->
<div class="row d-flex justify-content-start align-items-center" style="margin: 0 30px 5px 30px; padding: 0;">

  <select class="form-control z-depth-1" id="select_property" style="width: 100%; margin: 0; padding: 2px 5px; font-size: 17px; font-weight: bold; text-transform: uppercase; border: none; color: white; background-color: #303030;">
    {% for property in properties %}
    <option value="{{property.pk}}" style="font-size: 18px; text-transform: uppercase;">{{ property.name }}</option>
    {% endfor %}
  </select>

</div>
<!-- end of property selector -->

<div class="row d-flex" style="margin: 0 20px;">

  <!-- tiles -->
  <div class="d-flex flex-column" style="width: 100%; margin: 10px 10px;">

    <div class="d-flex flex-wrap justify-content-center z-depth-1" style="margin: 0; padding-top: 20px;">

      <div class="d-flex justify-content-between align-items-center" style="width: 200px; min-width: 200px; min-height: 90px; margin: 0 20px 20px 20px; padding: 0 15px; border: 1px solid #151515;">
        <div class="d-flex flex-column">
          <span class="active-tenants-span" style="color: black; font-size: 25px;">{{ active_tenants }}</span>
          <span style="color: black; font-size: 15px; font-weight: 500;">Tenant(s)</span>
          <span style="font-size: 10px;">All active tenants</span>
        </div>
        <div class="" style="width: 50px; height: 50px; background-image: url('static/img/tenant.png'); background-repeat: no-repeat; background-position: center; background-size: cover;">
        </div>
      </div>

      <div class="d-flex justify-content-between align-items-center" style="width: 200px; min-width: 200px; min-height: 90px; margin: 0 20px 20px 20px; padding: 0 15px; border: 1px solid #151515;">
        <div class="d-flex flex-column">
          <span class="pending-bookings-span" style="color: black; font-size: 25px;">{{ pending_bookings }}</span>
          <span style="color: black; font-size: 15px; font-weight: 500;">Booking(s)</span>
          <span style="font-size: 10px;">Waiting for approval</span>
        </div>
        <div class="" style="width: 50px; height: 50px; background-image: url('static/img/booking.png'); background-repeat: no-repeat; background-position: center; background-size: cover;">
        </div>
      </div>

      <div class="d-flex justify-content-between align-items-center" style="width: 200px; min-width: 200px; min-height: 90px; margin: 0 20px 20px 20px; padding: 0 15px; border: 1px solid #151515;">
        <div class="d-flex flex-column">
          <span class="active-rooms-span" style="color: black; font-size: 25px;">{{ active_rooms }}</span>
          <span style="color: black; font-size: 15px; font-weight: 500;">Active Room(s)</span>
          <span style="font-size: 10px;">As of this moment</span>
        </div>
        <div class="" style="width: 50px; height: 50px; background-image: url('static/img/lock.png'); background-repeat: no-repeat; background-position: center; background-size: cover;">
        </div>
      </div>

      <div class="d-flex justify-content-between align-items-center" style="width: 200px; min-width: 200px; min-height: 90px; margin: 0 20px 20px 20px; padding: 0 15px; border: 1px solid #151515;">
        <div class="d-flex flex-column">
          <span class="avail-rooms-span" style="color: black; font-size: 25px;">{{ avail_rooms }}</span>
          <span style="color: black; font-size: 15px; font-weight: 500;">Available Room(s)</span>
          <span style="font-size: 10px;">As of this moment</span>
        </div>
        <div class="" style="width: 50px; height: 50px; background-image: url('static/img/unlock.png'); background-repeat: no-repeat; background-position: center; background-size: cover;">
        </div>
      </div>

      <div class="d-flex justify-content-between align-items-center" style="width: 200px; min-width: 200px; min-height: 90px; margin: 0 20px 20px 20px; padding: 0 15px; border: 1px solid #151515;">
        <div class="d-flex flex-column">
          <span class="active-tenants-span" style="color: black; font-size: 25px;"></span>
          <span style="color: black; font-size: 15px; font-weight: 500;">Payment</span>
          <span style="font-size: 10px;">For This Month</span>
        </div>
        <div class="" style="width: 50px; height: 50px; background-image: url('static/img/tenant.png'); background-repeat: no-repeat; background-position: center; background-size: cover;">
        </div>
      </div>

      <div class="d-flex justify-content-between align-items-center" style="width: 200px; min-width: 200px; min-height: 90px; margin: 0 20px 20px 20px; padding: 0 15px; border: 1px solid #151515;">
        <div class="d-flex flex-column">
          <span class="pending-bookings-span" style="color: black; font-size: 25px;"></span>
          <span style="color: black; font-size: 15px; font-weight: 500;">Expense</span>
          <span style="font-size: 10px;">For This Month</span>
        </div>
        <div class="" style="width: 50px; height: 50px; background-image: url('static/img/booking.png'); background-repeat: no-repeat; background-position: center; background-size: cover;">
        </div>
      </div>

      <div class="d-flex justify-content-between align-items-center" style="width: 200px; min-width: 200px; min-height: 90px; margin: 0 20px 20px 20px; padding: 0 15px; border: 1px solid #151515;">
        <div class="d-flex flex-column">
          <span class="net-span" style="color: black; font-size: 25px;"></span>
          <span style="color: black; font-size: 15px; font-weight: 500;">Net Income</span>
          <span style="font-size: 10px;">For This Month</span>
        </div>
        <div class="" style="width: 50px; height: 50px; background-image: url('static/img/net_income.png'); background-repeat: no-repeat; background-position: center; background-size: cover;">
        </div>
      </div>

    </div>

  </div>
  <!-- end of tiles -->

  <!-- report -->
  <div class="z-depth-1" style="width: 100%; margin: 10px 10px;">

    <!-- generate report -->
    <div class="d-flex flex-column" style="margin-bottom: 20px; padding: 10px;">

      <span style="color: black; text-transform: uppercase; font-size: 18px; font-weight: bold;">GENERATE REPORT</span>

      <form class="d-flex flex-column" action="" method="post" style="margin-top: 20px;">

        <span id="title" style="margin-right: 10px; color: black; font-size: 15px; text-transform: uppercase; font-weight: bold;">Report Type</span>

        <select class="form-control form-control-sm" id="report_type" name="report_type" style="margin: 10px 0; text-transform: uppercase;" onchange="filter()" required>
          <option value="none" style="text-transform: uppercase;">----- select -----</option>
          <option value="Room" style="text-transform: uppercase;">Room</option>
          <option value="Tenant" style="text-transform: uppercase;">Tenant</option>
          <option value="Payment" style="text-transform: uppercase;">Payment</option>
          <option value="Expense" style="text-transform: uppercase;">Expense</option>
        </select>

        <div class="" id="div_room_filter" style="display: none;">
          <span style="margin-right: 10px; color: black; font-size: 15px; text-transform: uppercase; font-weight: bold;">Filter</span>
          <select class="form-control form-control-sm" id="room_filter" name="" style="margin: 10px 0; text-transform: uppercase;">
            <option value="" style="text-transform: uppercase;">----- select -----</option>
            <option value="" style="text-transform: uppercase;">All</option>
            <option value="" style="text-transform: uppercase;">Active only</option>
            <option value="" style="text-transform: uppercase;">Available only</option>
          </select>
        </div>

        <div class="" id="div_payment_filter" style="display: none;">

          <span style="margin-right: 10px; color: black; font-size: 15px; text-transform: uppercase; font-weight: bold;">Filter</span>

          <select class="form-control form-control-sm" id="payment_filter" name="" style="margin: 10px 0; text-transform: uppercase;" onchange="filter()" required>
            <option value="none" style="text-transform: uppercase;">----- select -----</option>
            <option value="All" style="text-transform: uppercase;">All</option>
            <option value="Custom" style="text-transform: uppercase;">Custom</option>
          </select>

          <div class="" id="div_payment_filter_year" style="display: none;">
            <span style="margin-right: 10px; color: black; font-size: 15px; text-transform: uppercase; font-weight: bold;">Year</span>
            <div class="d-flex flex-wrap justify-content-start align-items-center">
              <div class="form-group z-depth-1" style="margin: 10px; padding: 10px;">
                <input type="checkbox" id="January" name="" value="">
                <label for="January" style="font-size: 15px; text-transform: uppercase;">2020</label>
              </div>
            </div>
          </div>

          <div class="" id="div_payment_filter_month" style="display: none;">
            <span style="margin-right: 10px; color: black; font-size: 15px; text-transform: uppercase; font-weight: bold;">Month</span>
            <div class="d-flex flex-wrap justify-content-center align-items-center">
              <div class="form-group z-depth-1" style="margin: 10px; padding: 10px;">
                <input type="checkbox" id="January" name="" value="">
                <label for="January" style="font-size: 15px; text-transform: uppercase;">January</label>
              </div>
              <div class="form-group z-depth-1" style="margin: 10px; padding: 10px;">
                <input type="checkbox" id="February" name="" value="">
                <label for="February" style="font-size: 15px; text-transform: uppercase;">February</label>
              </div>
              <div class="form-group z-depth-1" style="margin: 10px; padding: 10px;">
                <input type="checkbox" id="March" name="" value="">
                <label for="March" style="font-size: 15px; text-transform: uppercase;">March</label>
              </div>
              <div class="form-group z-depth-1" style="margin: 10px; padding: 10px;">
                <input type="checkbox" id="April" name="" value="">
                <label for="April" style="font-size: 15px; text-transform: uppercase;">April</label>
              </div>
              <div class="form-group z-depth-1" style="margin: 10px; padding: 10px;">
                <input type="checkbox" id="May" name="" value="">
                <label for="May" style="font-size: 15px; text-transform: uppercase;">May</label>
              </div>
              <div class="form-group z-depth-1" style="margin: 10px; padding: 10px;">
                <input type="checkbox" id="June" name="" value="">
                <label for="June" style="font-size: 15px; text-transform: uppercase;">June</label>
              </div>
              <div class="form-group z-depth-1" style="margin: 10px; padding: 10px;">
                <input type="checkbox" id="July" name="" value="">
                <label for="July" style="font-size: 15px; text-transform: uppercase;">July</label>
              </div>
              <div class="form-group z-depth-1" style="margin: 10px; padding: 10px;">
                <input type="checkbox" id="August" name="" value="">
                <label for="August" style="font-size: 15px; text-transform: uppercase;">August</label>
              </div>
              <div class="form-group z-depth-1" style="margin: 10px; padding: 10px;">
                <input type="checkbox" id="September" name="" value="">
                <label for="September" style="font-size: 15px; text-transform: uppercase;">September</label>
              </div>
              <div class="form-group z-depth-1" style="margin: 10px; padding: 10px;">
                <input type="checkbox" id="October" name="" value="">
                <label for="October" style="font-size: 15px; text-transform: uppercase;">October</label>
              </div>
              <div class="form-group z-depth-1" style="margin: 10px; padding: 10px;">
                <input type="checkbox" id="November" name="" value="">
                <label for="November" style="font-size: 15px; text-transform: uppercase;">November</label>
              </div>
              <div class="form-group z-depth-1" style="margin: 10px; padding: 10px;">
                <input type="checkbox" id="December" name="" value="">
                <label for="December" style="font-size: 15px; text-transform: uppercase;">December</label>
              </div>
            </div>
          </div>

        </div>

        <div class="" id="div_expense_filter" style="display: none;">

          <span style="margin-right: 10px; color: black; font-size: 15px; text-transform: uppercase; font-weight: bold;">Filter</span>

          <select class="form-control form-control-sm" id="expense_filter" name="" style="margin: 10px 0; text-transform: uppercase;" onchange="filter()" required>
            <option value="none" style="text-transform: uppercase;">----- select -----</option>
            <option value="All" style="text-transform: uppercase;">All</option>
            <option value="Custom" style="text-transform: uppercase;">Custom</option>
          </select>

          <div class="" id="div_expense_filter_year">
            <span style="margin-right: 10px; color: black; font-size: 15px; text-transform: uppercase; font-weight: bold;">Year</span>
            <div class="d-flex flex-wrap justify-content-start align-items-center">
              <div class="form-group z-depth-1" style="margin: 10px; padding: 10px;">
                <input type="checkbox" id="January" name="" value="">
                <label for="January" style="font-size: 15px; text-transform: uppercase;">2020</label>
              </div>
            </div>
          </div>

          <div class="" id="div_expense_filter_month">
            <span style="margin-right: 10px; color: black; font-size: 15px; text-transform: uppercase; font-weight: bold;">Month</span>
            <div class="d-flex flex-wrap justify-content-center align-items-center">
              <div class="form-group z-depth-1" style="margin: 10px; padding: 10px;">
                <input type="checkbox" id="January" name="" value="">
                <label for="January" style="font-size: 15px; text-transform: uppercase;">January</label>
              </div>
              <div class="form-group z-depth-1" style="margin: 10px; padding: 10px;">
                <input type="checkbox" id="February" name="" value="">
                <label for="February" style="font-size: 15px; text-transform: uppercase;">February</label>
              </div>
              <div class="form-group z-depth-1" style="margin: 10px; padding: 10px;">
                <input type="checkbox" id="March" name="" value="">
                <label for="March" style="font-size: 15px; text-transform: uppercase;">March</label>
              </div>
              <div class="form-group z-depth-1" style="margin: 10px; padding: 10px;">
                <input type="checkbox" id="April" name="" value="">
                <label for="April" style="font-size: 15px; text-transform: uppercase;">April</label>
              </div>
              <div class="form-group z-depth-1" style="margin: 10px; padding: 10px;">
                <input type="checkbox" id="May" name="" value="">
                <label for="May" style="font-size: 15px; text-transform: uppercase;">May</label>
              </div>
              <div class="form-group z-depth-1" style="margin: 10px; padding: 10px;">
                <input type="checkbox" id="June" name="" value="">
                <label for="June" style="font-size: 15px; text-transform: uppercase;">June</label>
              </div>
              <div class="form-group z-depth-1" style="margin: 10px; padding: 10px;">
                <input type="checkbox" id="July" name="" value="">
                <label for="July" style="font-size: 15px; text-transform: uppercase;">July</label>
              </div>
              <div class="form-group z-depth-1" style="margin: 10px; padding: 10px;">
                <input type="checkbox" id="August" name="" value="">
                <label for="August" style="font-size: 15px; text-transform: uppercase;">August</label>
              </div>
              <div class="form-group z-depth-1" style="margin: 10px; padding: 10px;">
                <input type="checkbox" id="September" name="" value="">
                <label for="September" style="font-size: 15px; text-transform: uppercase;">September</label>
              </div>
              <div class="form-group z-depth-1" style="margin: 10px; padding: 10px;">
                <input type="checkbox" id="October" name="" value="">
                <label for="October" style="font-size: 15px; text-transform: uppercase;">October</label>
              </div>
              <div class="form-group z-depth-1" style="margin: 10px; padding: 10px;">
                <input type="checkbox" id="November" name="" value="">
                <label for="November" style="font-size: 15px; text-transform: uppercase;">November</label>
              </div>
              <div class="form-group z-depth-1" style="margin: 10px; padding: 10px;">
                <input type="checkbox" id="December" name="" value="">
                <label for="December" style="font-size: 15px; text-transform: uppercase;">December</label>
              </div>
            </div>
          </div>

        </div>

        <button class="btn btn-s btn-dark" id="generate_button" type="button" name="button" style="margin: 40px auto;">GENERATE</button>

      </form>

    </div>
    <!-- end of generate report -->

  </div>
  <!-- end of report -->

</div>

{% else %}

<div class="d-flex justify-content-center" style="margin-top: 50px;">
  <span style="font-size: 18px;">There are currently no registered properties under your account. <a href="{% url 'property_management' %}">Click here.</a></span>
</div>

{% endif %}

{% endblock %}

{% block extra_js %}

<script type="text/javascript">

function filter() {

  var type = document.getElementById("report_type").value;

  if (type == "none") {
    document.getElementById("div_room_filter").style.display = "none";
    document.getElementById("div_payment_filter").style.display = "none";
    document.getElementById("div_expense_filter").style.display = "none";
  } else if (type == "Tenant"){
    document.getElementById("div_room_filter").style.display = "none";
    document.getElementById("div_payment_filter").style.display = "none";
    document.getElementById("div_expense_filter").style.display = "none";
  } else if (type == "Room") {
    document.getElementById("div_room_filter").style.display = "block";
    document.getElementById("div_payment_filter").style.display = "none";
    document.getElementById("div_expense_filter").style.display = "none";
  } else if (type == "Payment") {
    document.getElementById("div_payment_filter").style.display = "block";
    document.getElementById("div_room_filter").style.display = "none";
    document.getElementById("div_expense_filter").style.display = "none";

    var payment_filter = document.getElementById("payment_filter").value;

    if (payment_filter == "Custom") {
      document.getElementById("div_payment_filter_year").style.display = "block";
      document.getElementById("div_payment_filter_month").style.display = "block";
    } else {
      document.getElementById("div_payment_filter_year").style.display = "none";
      document.getElementById("div_payment_filter_month").style.display = "none";
    }
  } else if (type == "Expense") {
    document.getElementById("div_expense_filter").style.display = "block";
    document.getElementById("div_room_filter").style.display = "none";
    document.getElementById("div_payment_filter").style.display = "none";

    var expense_filter = document.getElementById("expense_filter").value;

    if (expense_filter == "Custom") {
      document.getElementById("div_expense_filter_year").style.display = "block";
      document.getElementById("div_expense_filter_month").style.display = "block";
    } else {
      document.getElementById("div_expense_filter_year").style.display = "none";
      document.getElementById("div_expense_filter_month").style.display = "none";
    }
  }
}

</script>

<script type=" text/javascript">

  $(document).ready(function() {
    var val = $('.property-select').val();
    var my = $('.my-select').val();
    $('#generate-month-year-cashflow').attr("href", "/generate/cashflow/" + my);
    $('#generate-rooms-list').attr("href", "/generate/rooms/" + val);
    $('#generate-tenants-list').attr("href", "/generate/tenants/" + val);
    $('#generate-payments-list').attr("href", "/generate/payments/" + val);
    $('#generate-expenses-list').attr("href", "/generate/expenses/" + val);
    $('.property-name-span').html($(".property-select option:selected").text());
    $.ajax({
      url: '/home-ajax',
      data: {
        'val': val,
        'my': my
      },
      dataType: 'json',
      success: function(data) {
        if (data) {
          $('.active-tenants-span').html(data.active_tenants);
          $('.pending-bookings-span').html(data.pending_bookings);
          $('.active-rooms-span').html(data.active_rooms);
          $('.avail-rooms-span').html(data.avail_rooms);
          $('.payments-span').html(data.payments);
          $('.expenses-span').html(data.expenses);
          $('.net-span').html(data.net_income);
        }
      }
    });
    $(".property-select").on("change", function() {
      var val = $('.property-select').val();
      var my = $('.my-select').val();
      $('.property-name-span').html($(".property-select option:selected").text());
      $('#generate-rooms-list').attr("href", "/generate/rooms/" + val);
      $('#generate-tenants-list').attr("href", "/generate/tenants/" + val);
      $('#generate-payments-list').attr("href", "/generate/payments/" + val);
      $('#generate-expenses-list').attr("href", "/generate/expenses/" + val);
      $.ajax({
        url: '/home-ajax',
        data: {
          'val': val,
          'my': my
        },
        dataType: 'json',
        success: function(data) {
          if (data) {
            $('.active-tenants-span').html(data.active_tenants);
            $('.pending-bookings-span').html(data.pending_bookings);
            $('.active-rooms-span').html(data.active_rooms);
            $('.avail-rooms-span').html(data.avail_rooms);
            $('.payments-span').html(data.payments);
            $('.expenses-span').html(data.expenses);
            $('.net-span').html(data.net_income);
          }
        }
      });
    });
    $(".my-select").on("change", function() {
      var val = $('.property-select').val();
      var my = $('.my-select').val();
      $('#generate-month-year-cashflow').attr("href", "/generate/cashflow/" + my);
      $.ajax({
        url: '/home-ajax',
        data: {
          'val': val,
          'my': my
        },
        dataType: 'json',
        success: function(data) {
          if (data) {
            $('.active-tenants-span').html(data.active_tenants);
            $('.pending-bookings-span').html(data.pending_bookings);
            $('.active-rooms-span').html(data.active_rooms);
            $('.avail-rooms-span').html(data.avail_rooms);
            $('.payments-span').html(data.payments);
            $('.expenses-span').html(data.expenses);
            $('.net-span').html(data.net_income);
          }
        }
      });
    });
  });
</script>

{% endblock extra_js %}
